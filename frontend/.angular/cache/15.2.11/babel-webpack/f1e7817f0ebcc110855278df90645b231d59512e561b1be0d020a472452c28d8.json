{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/websocket.service\";\nimport * as i2 from \"@angular/common\";\nfunction TransactionListComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMessage, \" \");\n  }\n}\nfunction TransactionListComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1, \" Connecting to WebSocket... \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TransactionListComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 8);\n    i0.ɵɵtext(1, \" No transactions yet. Add some! \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TransactionListComponent_li_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\", 9)(1, \"div\", 10)(2, \"span\", 11);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 12);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"number\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 13);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const transaction_r4 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(transaction_r4.description);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"$\", i0.ɵɵpipeBind2(6, 3, transaction_r4.amount, \"1.2-2\"), \"\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" (\", ctx_r3.getTimeDifference(transaction_r4.timestamp), \") \");\n  }\n}\nexport let TransactionListComponent = /*#__PURE__*/(() => {\n  class TransactionListComponent {\n    constructor(websocketService) {\n      this.websocketService = websocketService;\n      this.transactions = []; // Array to hold the list of transactions\n      this.websocketConnected = false;\n      this.errorMessage = '';\n    }\n    ngOnInit() {\n      // 1. Establish WebSocket connection (if not already connected by another component)\n      // The `connect` method is idempotent, so calling it multiple times is safe.\n      const websocketUrl = 'ws://localhost:8000/ws/transactions/';\n      this.websocketService.connect(websocketUrl);\n      // 2. Subscribe to incoming WebSocket messages\n      this.websocketSubscription = this.websocketService.getMessages().subscribe(message => {\n        // Handle connection status messages\n        if (message.type === 'status') {\n          this.websocketConnected = message.connected;\n          this.errorMessage = message.error ? 'WebSocket error: ' + message.error : '';\n          if (!this.websocketConnected) {\n            this.errorMessage = 'WebSocket disconnected. Please check backend server.';\n          } else {\n            this.errorMessage = ''; // Clear error on successful connect\n          }\n        }\n        // Handle incoming new transaction messages from the backend\n        else if (message.type === 'transaction_added_confirmation') {\n          // Match the 'type' your backend sends\n          const wsMessage = message; // Cast to your expected type\n          const newTransaction = {\n            description: wsMessage.data.description,\n            amount: wsMessage.data.amount,\n            timestamp: new Date() // Add a timestamp for 'Just now' display\n          };\n\n          this.transactions.push(newTransaction);\n          this.transactions.sort((a, b) => (b.timestamp?.getTime() || 0) - (a.timestamp?.getTime() || 0)); // Sort by newest first\n          console.log('New transaction added:', newTransaction);\n        }\n        // Handle any other message types if needed\n        else {\n          console.log('Received unhandled WebSocket message:', message);\n        }\n      }, error => {\n        console.error('WebSocket subscription error:', error);\n        this.errorMessage = 'WebSocket connection error.';\n        this.websocketConnected = false;\n      }, () => {\n        console.log('WebSocket subscription completed.');\n        this.websocketConnected = false;\n        this.errorMessage = 'WebSocket connection closed.';\n      });\n    }\n    // Helper function to format the timestamp\n    getTimeDifference(timestamp) {\n      if (!timestamp) {\n        return '';\n      }\n      const now = new Date();\n      const seconds = Math.floor((now.getTime() - timestamp.getTime()) / 1000);\n      if (seconds < 60) {\n        return 'Just now';\n      } else if (seconds < 3600) {\n        const minutes = Math.floor(seconds / 60);\n        return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;\n      } else if (seconds < 86400) {\n        const hours = Math.floor(seconds / 3600);\n        return `${hours} hour${hours > 1 ? 's' : ''} ago`;\n      } else {\n        const days = Math.floor(seconds / 86400);\n        return `${days} day${days > 1 ? 's' : ''} ago`;\n      }\n    }\n    ngOnDestroy() {\n      if (this.websocketSubscription) {\n        this.websocketSubscription.unsubscribe();\n      }\n      // Decide if you want to close the WebSocket connection here or let the service manage it\n      // If other components might use it, let the service manage. If this is the only one, close it.\n      // this.websocketService.close();\n    }\n  }\n\n  TransactionListComponent.ɵfac = function TransactionListComponent_Factory(t) {\n    return new (t || TransactionListComponent)(i0.ɵɵdirectiveInject(i1.WebsocketService));\n  };\n  TransactionListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TransactionListComponent,\n    selectors: [[\"app-transaction-list\"]],\n    decls: 8,\n    vars: 4,\n    consts: [[1, \"transaction-list-container\"], [\"class\", \"error-message-banner\", 4, \"ngIf\"], [\"class\", \"warning-message-banner\", 4, \"ngIf\"], [\"class\", \"no-transactions\", 4, \"ngIf\"], [1, \"transaction-items\"], [\"class\", \"transaction-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"error-message-banner\"], [1, \"warning-message-banner\"], [1, \"no-transactions\"], [1, \"transaction-item\"], [1, \"transaction-details\"], [1, \"transaction-description\"], [1, \"transaction-amount\"], [1, \"transaction-timestamp\"]],\n    template: function TransactionListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n        i0.ɵɵtext(2, \"Transaction List\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(3, TransactionListComponent_div_3_Template, 2, 1, \"div\", 1);\n        i0.ɵɵtemplate(4, TransactionListComponent_div_4_Template, 2, 0, \"div\", 2);\n        i0.ɵɵtemplate(5, TransactionListComponent_div_5_Template, 2, 0, \"div\", 3);\n        i0.ɵɵelementStart(6, \"ul\", 4);\n        i0.ɵɵtemplate(7, TransactionListComponent_li_7_Template, 9, 6, \"li\", 5);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.websocketConnected && !ctx.errorMessage);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.transactions.length === 0 && ctx.websocketConnected);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.transactions);\n      }\n    },\n    dependencies: [i2.NgForOf, i2.NgIf, i2.DecimalPipe],\n    styles: [\".transaction-list-container[_ngcontent-%COMP%]{padding:25px;max-width:600px;margin:20px auto;border:1px solid #444;border-radius:12px;box-shadow:0 4px 20px #0000004d,inset 0 1px #ffffff1a;background:radial-gradient(circle at 20% 80%,rgba(41,98,255,.1) 0%,transparent 50%),radial-gradient(circle at 80% 20%,rgba(156,39,176,.1) 0%,transparent 50%),linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%);font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;position:relative;overflow:hidden}.transaction-list-container[_ngcontent-%COMP%]:before{content:\\\"\\\";position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 0%,rgba(100,149,237,.6) 50%,transparent 100%)}h2[_ngcontent-%COMP%]{text-align:center;color:#e0e0e0;margin-bottom:25px;font-weight:600;text-shadow:0 2px 4px rgba(0,0,0,.5);position:relative}h2[_ngcontent-%COMP%]:after{content:\\\"\\\";position:absolute;bottom:-8px;left:50%;transform:translate(-50%);width:60px;height:2px;background:linear-gradient(90deg,transparent,#4fc3f7,transparent)}.error-message-banner[_ngcontent-%COMP%], .warning-message-banner[_ngcontent-%COMP%]{padding:12px;border-radius:6px;text-align:center;margin-bottom:20px;font-weight:700;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1);box-shadow:0 2px 8px #0003}.error-message-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(244,67,54,.2) 0%,rgba(211,47,47,.15) 100%);color:#ff8a80;border:1px solid rgba(244,67,54,.3)}.warning-message-banner[_ngcontent-%COMP%]{background:linear-gradient(135deg,rgba(255,152,0,.2) 0%,rgba(245,124,0,.15) 100%);color:#ffd54f;border:1px solid rgba(255,152,0,.3)}.no-transactions[_ngcontent-%COMP%]{text-align:center;color:#b0b0b0;font-style:italic;padding:30px;border:1px dashed rgba(255,255,255,.1);border-radius:8px;margin-top:20px;background:rgba(255,255,255,.05);backdrop-filter:blur(5px)}.transaction-items[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.transaction-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid rgba(255,255,255,.1);transition:all .3s ease;position:relative;overflow:hidden}.transaction-item[_ngcontent-%COMP%]:before{content:\\\"\\\";position:absolute;left:-100%;top:0;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(100,149,237,.1),transparent);transition:left .5s ease}.transaction-item[_ngcontent-%COMP%]:hover:before{left:100%}.transaction-item[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.05);border-radius:6px;padding-left:12px;padding-right:12px;transform:translate(4px)}.transaction-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.transaction-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-grow:1}.transaction-description[_ngcontent-%COMP%]{font-weight:600;color:#e0e0e0;font-size:1.1em;margin-bottom:4px;text-shadow:0 1px 2px rgba(0,0,0,.3)}.transaction-amount[_ngcontent-%COMP%]{color:#4fc3f7;font-size:1.05em;font-weight:700;text-shadow:0 0 10px rgba(79,195,247,.3);letter-spacing:.5px}.transaction-timestamp[_ngcontent-%COMP%]{color:#9e9e9e;font-size:.85em;font-style:italic;text-shadow:0 1px 2px rgba(0,0,0,.3)}.transaction-list-container[_ngcontent-%COMP%]:after{content:\\\"\\\";position:absolute;inset:0;background-image:radial-gradient(circle at 25% 25%,rgba(255,255,255,.05) 1px,transparent 1px),radial-gradient(circle at 75% 75%,rgba(255,255,255,.03) 1px,transparent 1px);background-size:30px 30px,20px 20px;pointer-events:none;z-index:0}.transaction-list-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{position:relative;z-index:1}\"]\n  });\n  return TransactionListComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}